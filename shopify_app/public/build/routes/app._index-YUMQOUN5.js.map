{
  "version": 3,
  "sources": ["../../../app/routes/app._index.jsx", "../../../app/controllers/api/webhooks/webhooks_interface.js", "../../../app/controllers/api/webhooks/webhooks_manager.js", "../../../app/config.js"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/app._index.jsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/app._index.jsx\");\n  import.meta.hot.lastModified = \"1701989240740.8035\";\n}\n// REMIX HMR END\n\nimport { authenticate } from \"../shopify.server\";\nimport { Card, Page, Text, Layout, Button } from \"@shopify/polaris\";\nimport { useLoaderData, useSubmit } from \"@remix-run/react\";\nimport webhooks from \"../controllers/api/webhooks/webhooks_interface.js\";\nexport async function loader({\n  request\n}) {\n  const {\n    admin\n  } = await authenticate.admin(request);\n  const {\n    error,\n    ids\n  } = await webhooks.getAll(admin.graphql, \"ORDERS_CREATE\");\n  return {\n    error,\n    ids\n  };\n}\nexport async function action({\n  request\n}) {\n  const {\n    admin\n  } = await authenticate.admin(request);\n  const data = await request.formData();\n  const action = await data.get(\"action\");\n  let error;\n  if (action === \"create-subscription\") {\n    const {\n      error: createError\n    } = await webhooks.createOne(admin.graphql, \"ORDERS_CREATE\");\n    if (createError) error = createError;\n  }\n  if (action === \"delete-subscriptions\") {\n    const {\n      error: deleteError\n    } = await webhooks.deleteAll(admin.graphql, \"ORDERS_CREATE\");\n    if (deleteError) error = deleteError;\n  }\n  return {\n    error\n  };\n}\nexport default function Index() {\n  _s();\n  const loaderData = useLoaderData();\n  const submit = useSubmit();\n  return <Page>\n      <Text as=\"h1\" variant=\"headingLg\">{loaderData?.error}</Text>\n\n      <Button onClick={() => {\n      submit({\n        action: \"delete-subscriptions\"\n      }, {\n        method: \"POST\"\n      });\n    }}>\n        Delete All Webhook Subscriptions\n      </Button>\n      <Button onClick={() => {\n      submit({\n        action: \"create-subscription\"\n      }, {\n        method: \"POST\"\n      });\n    }}>\n        Create a Webhook Subscription\n      </Button>\n\n      <Card>\n        <Layout>\n          {loaderData?.ids && loaderData.ids.map(id => <Layout.Section>\n                <Text as=\"h3\" variant=\"bodyLg\">{id}</Text>\n              </Layout.Section>)}\n        </Layout>\n      </Card>\n    </Page>;\n}\n_s(Index, \"Xae86aUTtug9kyQ7XEW4c1bDe+E=\", false, function () {\n  return [useLoaderData, useSubmit];\n});\n_c = Index;\nvar _c;\n$RefreshReg$(_c, \"Index\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;", "// REMIX HMR BEGIN\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\nimport.meta.hot = __hmr__.createHotContext(\n//@ts-expect-error\n\"app/controllers/api/webhooks/webhooks_interface.js\"\n);\nimport.meta.hot.lastModified = \"1701989150977.143\";\n}\n// REMIX HMR END\n\nimport manager from \"./webhooks_manager.js\";\n\nasync function getAll(graphql, topic) {\n    const { error, ids } = await manager.getAll(graphql, topic);\n    return { error, ids };\n}\n\nasync function createOne(graphql, topic) {\n    const { error } = await manager.createOne(graphql, topic);\n    return { error };\n}\n\nasync function deleteAll(graphql, topic) {\n    const { error, ids } = await manager.getAll(graphql, topic);\n    if (error) return { error };\n    for (const id of ids) {\n        const { error: deleteError } = await manager.deleteOne(graphql, id);\n        if (deleteError) return { error: deleteError };\n    }\n    return {};\n}\n\nexport default { getAll, createOne, deleteAll };\n", "// REMIX HMR BEGIN\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\nimport.meta.hot = __hmr__.createHotContext(\n//@ts-expect-error\n\"app/controllers/api/webhooks/webhooks_manager.js\"\n);\nimport.meta.hot.lastModified = \"1701989171071.2761\";\n}\n// REMIX HMR END\n\nimport config from \"../../../config.js\";;\n\nconst serverUrl = config.serverUrl;\nconst route = config.serverRoutes.webhooks.createOrder;\nconst endpoint = serverUrl + route;\n\nasync function makeQuery(graphql, queryString) {\n    const response = await graphql(queryString);\n    const responseJson = await response.json();\n    const data = responseJson.data;\n    return data;\n}\n\nasync function getAll(graphql, topic) {\n    const query = `\n    query {\n        webhookSubscriptions(first: 50, topics: ${topic}) {\n            edges {\n                node {\n                    id\n                }\n            }\n        }\n    }\n    `;\n    try {\n        const response = await makeQuery(graphql, query);\n        return { ids: response?.webhookSubscriptions?.edges?.map(s => s?.node?.id) };\n    } catch (e) {\n        return { error: e };\n    }\n}\n\nasync function createOne(graphql, topic) {\n    const query = `\n    mutation {\n        webhookSubscriptionCreate(\n            topic: ${topic}\n            webhookSubscription: {\n                callbackUrl: \"${endpoint}\"\n            }\n        ) {\n            webhookSubscription {\n                id\n            }\n        }\n    }\n    `;\n    try {\n        const response = await makeQuery(graphql, query);\n        if (!response) return { error: \"CREATE_WEBHOOK_SUBSCRIPTION_ERROR\" };\n        return {};\n    } catch (e) {\n        return { error: e };\n    }\n}\n\nasync function deleteOne(graphql, id) {\n    const query = `\n    mutation {\n        webhookSubscriptionDelete(id: \"${id}\") {\n            deletedWebhookSubscriptionId\n            userErrors {\n                field\n                message\n            }\n        }\n    }\n    `;\n    try {\n        const response = await makeQuery(graphql, query);\n        if (!response) return { error: \"DELETE_WEBHOOK_SUBSCRIPTION_ERROR\" };\n        return {};\n    } catch (e) {\n        return { error: e };\n    }\n}\n\nexport default { getAll, createOne, deleteOne };\n", "// REMIX HMR BEGIN\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\nimport.meta.hot = __hmr__.createHotContext(\n//@ts-expect-error\n\"app/config.js\"\n);\nimport.meta.hot.lastModified = \"1701988787102.035\";\n}\n// REMIX HMR END\n\nexport default {\n    serverUrl: \"https://1b6f-144-32-240-121.ngrok-free.app\",\n    serverRoutes: {\n        webhooks: {\n            createOrder: \"/webhook/order/create\"\n        }\n    }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA;AASA,qBAA6B;AAC7BA;AACA;;;ACtBA;;;ACAA;;;ACAA;AACA,IAAI,aAAa;AACjB,cAAY,MAAc;AAAA;AAAA,IAE1B;AAAA,EACA;AACA,cAAY,IAAI,eAAe;AAC/B;AAGA,IAAO,iBAAQ;AAAA,EACX,WAAW;AAAA,EACX,cAAc;AAAA,IACV,UAAU;AAAA,MACN,aAAa;AAAA,IACjB;AAAA,EACJ;AACJ;;;ADhBA,IAAI,aAAa;AACjB,cAAY,MAAc;AAAA;AAAA,IAE1B;AAAA,EACA;AACA,cAAY,IAAI,eAAe;AAC/B;AAKA,IAAM,YAAY,eAAO;AACzB,IAAM,QAAQ,eAAO,aAAa,SAAS;AAC3C,IAAM,WAAW,YAAY;;;ADb7B,IAAI,aAAa;AACjB,cAAY,MAAc;AAAA;AAAA,IAE1B;AAAA,EACA;AACA,cAAY,IAAI,eAAe;AAC/B;;;AD8DM;AArEN,IAAI,CAAC,OAAO,gBAAgB,CAAC,OAAO,gBAAgB,CAAC,OAAO,kBAAkB;AAC5E,UAAQ,KAAK,kGAAkG;AACjH,OAAO;AACD,mBAAiB,OAAO;AACxB,mBAAiB,OAAO;AAC5B,SAAO,eAAe,CAAC,MAAM,OAAO;AAClC,WAAO,iBAAiB,SAAS,MAAM,gCAAkC,EAAE;AAAA,EAC7E;AACA,SAAO,eAAe,OAAO,iBAAiB;AAChD;AANM;AACA;AAMN,IAAI,KAAK,aAAa;AAEtB,IAAI,aAAa;AACf,cAAY,MAAc;AAAA;AAAA,IAE1B;AAAA,EAA2B;AAC3B,cAAY,IAAI,eAAe;AACjC;AA+Ce,SAAR,QAAyB;AAC9B,KAAG;AACH,QAAM,aAAa,cAAc;AACjC,QAAM,SAAS,UAAU;AACzB,SAAO,mDAAC,QACJ;AAAA,uDAAC,QAAK,IAAG,MAAK,SAAQ,aAAa,mDAAY,SAA/C;AAAA;AAAA;AAAA;AAAA,WAAqD;AAAA,IAErD,mDAAC,UAAO,SAAS,MAAM;AACvB,aAAO;AAAA,QACL,QAAQ;AAAA,MACV,GAAG;AAAA,QACD,QAAQ;AAAA,MACV,CAAC;AAAA,IACH,GAAG,gDAND;AAAA;AAAA;AAAA;AAAA,WAQA;AAAA,IACA,mDAAC,UAAO,SAAS,MAAM;AACvB,aAAO;AAAA,QACL,QAAQ;AAAA,MACV,GAAG;AAAA,QACD,QAAQ;AAAA,MACV,CAAC;AAAA,IACH,GAAG,6CAND;AAAA;AAAA;AAAA;AAAA,WAQA;AAAA,IAEA,mDAAC,QACC,6DAAC,UACE,oDAAY,QAAO,WAAW,IAAI,IAAI,QAAM,mDAAC,OAAO,SAAP,EACxC,6DAAC,QAAK,IAAG,MAAK,SAAQ,UAAU,gBAAhC;AAAA;AAAA;AAAA;AAAA,WAAmC,KADI;AAAA;AAAA;AAAA;AAAA,WAEzC,CAAiB,KAHvB;AAAA;AAAA;AAAA;AAAA,WAIA,KALF;AAAA;AAAA;AAAA;AAAA,WAMA;AAAA,OA5BG;AAAA;AAAA;AAAA;AAAA,SA6BL;AACJ;AACA,GAAG,OAAO,gCAAgC,OAAO,WAAY;AAC3D,SAAO,CAAC,eAAe,SAAS;AAClC,CAAC;AACD,KAAK;AACL,IAAI;AACJ,aAAa,IAAI,OAAO;AAExB,OAAO,eAAe;AACtB,OAAO,eAAe;",
  "names": ["init_esm"]
}
